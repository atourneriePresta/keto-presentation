# DO NOT EDIT THIS FILE
# If you want to customize to your needs, please use the docker-compose.override.yml file (create it if it does not exists)
version: "3.2"
services:
  keto-migrate:
    image: oryd/keto:v0.11.0-alpha.0
    working_dir: /home/ory
    volumes:
      - ./config/keto.yml:/home/ory/keto.yml
      - ./keto_namespaces:/home/ory/keto_namespaces
    networks:
      - keto
    environment:
      - LOG_LEVEL=debug
      - DSN=mysql://keto:password@tcp(mysql:3306)/keto
    command:
      migrate up -c /home/ory/keto.yml --yes
    restart: on-failure
  keto:
    image: oryd/keto:v0.11.0-alpha.0
    container_name: keto
    working_dir: /home/ory
    links:
      - mysql:mysql
    volumes:
      - ./config/keto.yml:/home/ory/keto.yml
      - ./keto_namespaces:/home/ory/keto_namespaces
    ports:
      - "4466:4466"
      - "4467:4467"
    depends_on:
      - keto-migrate
    networks:
      - keto
    environment:
      - LOG_LEVEL=debug
      - DSN=mysql://keto:password@tcp(mysql:3306)/keto
  mysql:
    image: mysql:8.0.32
    ports:
      - "3306:3306"
    environment:
      - MYSQL_ROOT_PASSWORD=secret
      - MYSQL_DATABASE=keto
    volumes:
      - ketoMysqlVolume:/var/lib/mysql
      - ./.docker/sql:/docker-entrypoint-initdb.d
    networks:
      - keto

volumes:
  ketoMysqlVolume:

networks:
  keto:
    driver: bridge